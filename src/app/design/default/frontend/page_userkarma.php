<?phpPageEngine::html("html_head");PageEngine::html("header", array("searchquery" => (isset($_GET["query"])?$_GET["query"]:"")));$db = new SQL(0);$userinfo = $db->cmdrow(0, 'SELECT * FROM user_list WHERE id={0} LIMIT 0,1', array($params["user_id"]));$infos = $db->cmdrows(0, 'SELECT T1.*, T2.title FROM karma_log as T1 LEFT JOIN questions as T2 ON T1.question=T2.id WHERE user={0} ORDER BY created DESC', array($userinfo["id"]));?>	<div id="Content" class="content-wrapper PageUserKarma">		<article>						<h1 class="search-result-summary"><?=_e("{0}'s Karma Ãœbersicht", array(0 => html($userinfo["username"]))); ?></h1><?php	PageEngine::html("box_userprofile_navi", array("id" => $userinfo["id"], "name" => $userinfo["username"]));?>						<script type="text/javascript" src="https://www.google.com/jsapi"></script>			<script type="text/javascript">				google.load("visualization", "1", {packages:["corechart"]});				google.setOnLoadCallback(drawChart);				function drawChart() {					var data = google.visualization.arrayToDataTable(<?php$out = array(array("Datum", "Karma"));$rows = $db->cmdrows(0, 'SELECT sum(points) as Karma, substr(stamp,1,10) as Datum FROM karma_log WHERE user={0} GROUP BY Datum ORDER BY Datum ASC', array($userinfo["id"]));$raws = array();$sum = 0;$time = $userinfo["dt_registered"]-86400;foreach ($rows as $row) $raws[$row["Datum"]] = $row["Karma"];while ($time < time()) {	$time += 86400;	if (isset($raws[date("Y-m-d", $time)])) $sum += $raws[date("Y-m-d", $time)];	$out[] = array(date("d.m.Y", $time), $sum);}echo(json_encode($out));	?>);        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));        chart.draw(data, {title: "Karma Verlauf",legend:{position: "none"}, hAxis: { title: "Datum"}, vAxis: { title: "Karma"}});				}			</script>						<table><tr style="vertical-align:top;">			<td style="width:640px;">			<div id="chart_div" style="width:640px; height:400px;"></div>			</td>			<td><div class="karma history">			<h3>Karma Logbuch</h3><?phpforeach ($infos as $row) {			echo('<p><span class="karma points '.($row["points"] < 0?"negative":"positive").'">'.$row["points"].'</span> <a class="question" href="'.Question::PermalinkByData($row["question"], $row["title"]).'" title="">'.html($row["title"]).'</a> <abbr class="date created" title="erhalten am '.date("d.m.Y", $row["created"]).' um '.date("H:i:s", $row["created"]).' Uhr">('.date("d.m.Y", $row["created"]).')</abbr></p>');} ?>			</div>			</td>						</tr></table>								</article>		</div><style>div.karma.history { overflow-y:auto; height:400px; }div.karma.history span.karma.points { float:left; display: block; font-weight: bold; border-radius: 4px; text-align: center; padding:2px; margin-right: 5px; width: 20px; height:20px; } div.karma.history span.negative { border: 1px solid #ff0000; background: #ffc0c0; color: #800000; }div.karma.history span.positive { border: 1px solid #00ff00; background: #c0ffc0; color: #008000; }div.karma.history a.question { font-size: 14px; font-family: 14px; color: #1B79BD; }div.karma.history abbr.date.created { font-size: 14px; color: #808080; }</style>			<?phpPageEngine::html("footer");?>	</body></html><?phpexit(1);?>